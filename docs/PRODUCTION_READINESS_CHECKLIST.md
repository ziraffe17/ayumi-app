# AYUMI 本番運用開始チェックリスト

**作成日**: 2025年11月4日
**対象**: 社内での実運用開始に向けた準備項目

---

## 📋 目次

1. [インフラ・サーバー環境](#1-インフラサーバー環境)
2. [セキュリティ対策](#2-セキュリティ対策)
3. [アプリケーション設定](#3-アプリケーション設定)
4. [データベース準備](#4-データベース準備)
5. [監視・アラート体制](#5-監視アラート体制)
6. [バックアップ・復旧体制](#6-バックアップ復旧体制)
7. [運用体制・マニュアル](#7-運用体制マニュアル)
8. [法令・コンプライアンス](#8-法令コンプライアンス)
9. [性能・負荷対策](#9-性能負荷対策)
10. [ユーザー対応準備](#10-ユーザー対応準備)

---

## 1. インフラ・サーバー環境

### 1.1 サーバー調達・構築

- [ ] **本番サーバーの調達**
  - [ ] サーバースペックの決定（推奨: 4コア、8GB RAM、100GB SSD以上）
  - [ ] VPS契約完了（推奨: ConoHa、さくら、Vultr等）
  - [ ] または、オンプレミスサーバー準備完了
  - [ ] OSインストール完了（Ubuntu 22.04 LTS / CentOS 8+）

- [ ] **ネットワーク環境**
  - [ ] 固定IPアドレス取得
  - [ ] ドメイン取得（例: ayumi-tsusho.jp）
  - [ ] DNSレコード設定（Aレコード、CNAMEレコード）
  - [ ] ファイアウォール設定（22, 80, 443番ポートのみ開放）
  - [ ] ポートフォワーディング設定（オンプレミスの場合）

- [ ] **SSL/TLS証明書**
  - [ ] SSL証明書取得（Let's Encrypt推奨）
  - [ ] 証明書の自動更新設定（Certbot）
  - [ ] HTTPSアクセス確認
  - [ ] HTTPからHTTPSへの自動リダイレクト確認

- [ ] **必須ソフトウェアインストール**
  - [ ] Docker Engine（最新版）
  - [ ] Docker Compose v2
  - [ ] Git
  - [ ] 必要なPHP拡張モジュール（pdo, mysql, redis, mbstring, xml等）

### 1.2 本番環境用Docker設定

- [ ] **docker-compose.production.yml 作成**
  - [ ] OPcache有効化（`PHP_OPCACHE_VALIDATE_TIMESTAMPS=0`）
  - [ ] 本番用ボリューム設定
  - [ ] ログ出力設定（json-file driver、サイズ制限）
  - [ ] リソース制限設定（CPU、メモリ上限）
  - [ ] 再起動ポリシー設定（`restart: unless-stopped`）

- [ ] **Nginx設定**
  - [ ] セキュリティヘッダー追加（HSTS, X-Frame-Options等）
  - [ ] Gzip圧縮有効化
  - [ ] 静的ファイルキャッシュ設定
  - [ ] レート制限設定（DDoS対策）
  - [ ] アクセスログ・エラーログ設定

### 1.3 外部サービス準備

- [ ] **メール送信サービス**
  - [ ] SendGrid / AWS SES / Gmail SMTP のいずれか契約
  - [ ] APIキー取得
  - [ ] ドメイン認証（SPF、DKIM、DMARC）
  - [ ] 送信テスト成功
  - [ ] 送信制限確認（1日100通で足りるか？）

- [ ] **バックアップストレージ**
  - [ ] オブジェクトストレージ契約（AWS S3 / Backblaze B2等）
  - [ ] または、外付けHDD/NAS準備
  - [ ] アクセスキー取得・設定

- [ ] **監視サービス**
  - [ ] UptimeRobot（無料）アカウント作成
  - [ ] または、Datadog / New Relic等の契約
  - [ ] 監視URL登録

---

## 2. セキュリティ対策

### 2.1 アプリケーションレベル

- [ ] **環境変数（.env）設定**
  - [ ] `APP_ENV=production` に設定
  - [ ] `APP_DEBUG=false` に設定
  - [ ] `APP_KEY` を新規生成（`php artisan key:generate`）
  - [ ] `SESSION_ENCRYPT=true` に設定
  - [ ] `SESSION_SECURE_COOKIE=true` に設定
  - [ ] `BCRYPT_ROUNDS=12` に設定
  - [ ] `.env` ファイルのパーミッション 600 に設定

- [ ] **セッション・Cookie設定**
  - [ ] `SESSION_DRIVER=redis` に設定
  - [ ] `SESSION_LIFETIME` 適切に設定（120分推奨）
  - [ ] `SESSION_SAME_SITE=lax` に設定
  - [ ] HTTPOnly Cookie有効化確認

- [ ] **パスワードポリシー**
  - [ ] 職員アカウント: 12文字以上、英数記号混在
  - [ ] 利用者アカウント: 8文字以上（簡易ログインコードの場合は個別管理）
  - [ ] パスワード有効期限設定（90日推奨）

- [ ] **2段階認証（2FA）**
  - [ ] 職員ログイン時のメールOTP認証動作確認
  - [ ] OTPコード有効期限設定（5分推奨）
  - [ ] メール送信失敗時のフォールバック設定

### 2.2 サーバーレベル

- [ ] **SSH設定**
  - [ ] SSHポート変更（22 → 別ポート、例: 2222）
  - [ ] 公開鍵認証のみ許可（パスワード認証無効化）
  - [ ] root ログイン無効化
  - [ ] SSH接続元IPアドレス制限（可能な場合）

- [ ] **ファイアウォール（ufw/iptables）**
  - [ ] デフォルトポリシーをDENYに設定
  - [ ] SSH（変更後のポート）のみ許可
  - [ ] HTTP（80）、HTTPS（443）のみ許可
  - [ ] MySQL（3306）外部アクセス禁止
  - [ ] Redis（6379）外部アクセス禁止

- [ ] **fail2ban設定**
  - [ ] fail2banインストール
  - [ ] SSH ブルートフォース対策設定
  - [ ] Nginx レート制限違反の自動BAN設定
  - [ ] bantime 3600秒、maxretry 5回 設定

- [ ] **OS セキュリティ**
  - [ ] 自動セキュリティアップデート有効化（unattended-upgrades）
  - [ ] 不要なサービス停止
  - [ ] タイムゾーン Asia/Tokyo 設定
  - [ ] NTP時刻同期設定

### 2.3 データベース

- [ ] **MySQLセキュリティ設定**
  - [ ] root パスワード変更（強力なパスワード）
  - [ ] 本番用DBユーザー作成（最小権限）
  - [ ] 外部からの直接アクセス禁止（bind-address=127.0.0.1）
  - [ ] テストデータベース削除
  - [ ] 匿名ユーザー削除

- [ ] **Redis セキュリティ**
  - [ ] Redisパスワード設定（`requirepass`）
  - [ ] 外部アクセス禁止（bind 127.0.0.1）
  - [ ] 危険なコマンド無効化（FLUSHDB, FLUSHALL等）

### 2.4 個人情報保護

- [ ] **データ暗号化**
  - [ ] 個人情報カラムの暗号化確認（`care_notes_enc`等）
  - [ ] データベースバックアップの暗号化

- [ ] **アクセス制御**
  - [ ] 監査ログミドルウェアの全画面適用
  - [ ] ロールベースアクセス制御（RBAC）動作確認
  - [ ] 管理者権限の分離（設定画面はadminのみ）

- [ ] **ログ管理**
  - [ ] 個人情報のログ出力禁止確認
  - [ ] アクセスログのローテーション設定
  - [ ] ログファイルのパーミッション 640 設定

---

## 3. アプリケーション設定

### 3.1 本番環境設定

- [ ] **.env.production 作成・設定**
  - [ ] データベース接続情報（本番用パスワード）
  - [ ] Redis接続情報（パスワード含む）
  - [ ] メール設定（SMTP認証情報）
  - [ ] アプリケーションURL（https://～）
  - [ ] ログレベル（warning または error）
  - [ ] ログチャネル（daily 推奨）

- [ ] **Laravel最適化**
  - [ ] `composer install --no-dev --optimize-autoloader` 実行
  - [ ] `php artisan config:cache` 実行
  - [ ] `php artisan route:cache` 実行
  - [ ] `php artisan view:cache` 実行
  - [ ] OPcache有効化確認

- [ ] **パフォーマンス設定**
  - [ ] キャッシュドライバ Redis 設定
  - [ ] セッションドライバ Redis 設定
  - [ ] キューワーカー設定（必要に応じて）

### 3.2 初期データ投入

- [ ] **管理者アカウント作成**
  - [ ] 管理者アカウント作成（強力なパスワード）
  - [ ] 管理者メールアドレス設定（実在するアドレス）
  - [ ] テスト用アカウント削除（user_id=1,2,3 等）

- [ ] **基礎データ**
  - [ ] 事業所情報設定（定員、営業日等）
  - [ ] 祝日データ取込（`HolidaySeeder`）
  - [ ] 職員アカウント作成（実際の職員）

- [ ] **テストデータ削除**
  - [ ] 開発用テストユーザー削除
  - [ ] サンプル出席記録削除
  - [ ] サンプル日報削除

---

## 4. データベース準備

### 4.1 データベース初期化

- [ ] **マイグレーション実行**
  - [ ] `php artisan migrate --force` 実行
  - [ ] マイグレーション成功確認
  - [ ] テーブル作成確認（`SHOW TABLES;`）
  - [ ] インデックス設定確認

- [ ] **データベース設定**
  - [ ] 文字コード utf8mb4 設定確認
  - [ ] タイムゾーン UTC 設定確認
  - [ ] ストレージエンジン InnoDB 確認

### 4.2 データベース最適化

- [ ] **インデックス確認**
  - [ ] 外部キーインデックス作成確認
  - [ ] 日付カラムインデックス確認
  - [ ] user_id カラムインデックス確認

- [ ] **クエリ最適化**
  - [ ] N+1クエリ問題解消確認
  - [ ] スロークエリログ有効化
  - [ ] EXPLAIN実行で主要クエリ確認

---

## 5. 監視・アラート体制

### 5.1 稼働監視

- [ ] **UptimeRobot設定**
  - [ ] 監視URL登録（https://ayumi.example.com）
  - [ ] チェック間隔 5分 設定
  - [ ] アラート先メールアドレス設定
  - [ ] SMS通知設定（重要な場合）

- [ ] **ヘルスチェックエンドポイント**
  - [ ] `/health` エンドポイント作成
  - [ ] データベース接続チェック
  - [ ] Redis接続チェック
  - [ ] ストレージ書き込みチェック

### 5.2 リソース監視

- [ ] **サーバーリソース監視**
  - [ ] CPU使用率監視（閾値: 80%）
  - [ ] メモリ使用率監視（閾値: 85%）
  - [ ] ディスク使用率監視（閾値: 90%）
  - [ ] ディスクI/O監視

- [ ] **アプリケーション監視**
  - [ ] エラーログ監視（500エラー発生時アラート）
  - [ ] レスポンスタイム監視（閾値: 3秒）
  - [ ] データベースコネクション数監視

### 5.3 ログ監視

- [ ] **ログ集約**
  - [ ] Laravelログ（storage/logs/laravel.log）
  - [ ] Nginxアクセスログ
  - [ ] Nginxエラーログ
  - [ ] MySQLスロークエリログ

- [ ] **ログローテーション**
  - [ ] logrotate設定（日次、30日保存）
  - [ ] 古いログの自動削除設定

---

## 6. バックアップ・復旧体制

### 6.1 バックアップ設定

- [ ] **データベースバックアップ**
  - [ ] 日次バックアップスクリプト作成
  - [ ] cron設定（毎日午前3時）
  - [ ] バックアップ保存先設定（ローカル + リモート）
  - [ ] 30日分のバックアップ保持設定
  - [ ] バックアップ暗号化設定

- [ ] **ファイルバックアップ**
  - [ ] アプリケーションファイルのバックアップ
  - [ ] .env ファイルのバックアップ
  - [ ] アップロードファイルのバックアップ（storage/）

- [ ] **バックアップテスト**
  - [ ] バックアップからのリストア成功確認
  - [ ] リストア所要時間測定（RTO確認）
  - [ ] データ整合性確認

### 6.2 災害復旧（DR）

- [ ] **DR計画策定**
  - [ ] RTO（目標復旧時間）設定（推奨: 4時間）
  - [ ] RPO（目標復旧時点）設定（推奨: 24時間）
  - [ ] DR手順書作成

- [ ] **DR訓練**
  - [ ] 年1回のDR訓練実施計画
  - [ ] バックアップサーバーへの切替手順確認
  - [ ] DNS切替手順確認

---

## 7. 運用体制・マニュアル

### 7.1 運用体制

- [ ] **役割分担**
  - [ ] システム管理者の選任
  - [ ] 運用担当者の選任（日次タスク）
  - [ ] セキュリティ担当者の選任
  - [ ] エスカレーション先の決定

- [ ] **緊急連絡体制**
  - [ ] 緊急連絡先リスト作成
  - [ ] 障害発生時の連絡フロー策定
  - [ ] 営業時間外の対応体制決定

### 7.2 運用マニュアル

- [ ] **日次運用タスク**
  - [ ] ログ確認手順
  - [ ] バックアップ確認手順
  - [ ] ディスク使用率確認手順

- [ ] **週次運用タスク**
  - [ ] セキュリティアップデート手順
  - [ ] 監査ログレビュー手順

- [ ] **月次運用タスク**
  - [ ] アクセス統計レビュー
  - [ ] ユーザーアカウント棚卸

### 7.3 ドキュメント整備

- [ ] **運用ドキュメント**
  - [ ] システム運用手順書
  - [ ] トラブルシューティングガイド
  - [ ] よくある質問（FAQ）

- [ ] **ユーザーマニュアル**
  - [ ] 利用者向けマニュアル
  - [ ] 職員向けマニュアル
  - [ ] 管理者向けマニュアル

- [ ] **技術ドキュメント**
  - [ ] システム構成図
  - [ ] ER図（データベース設計）
  - [ ] API仕様書

---

## 8. 法令・コンプライアンス

### 8.1 個人情報保護法対応

- [ ] **個人情報取扱規程**
  - [ ] 個人情報取扱規程の策定
  - [ ] プライバシーポリシーの作成
  - [ ] 利用目的の明示

- [ ] **同意取得**
  - [ ] 利用者からの同意取得（書面またはシステム上）
  - [ ] 職員からの同意取得
  - [ ] 第三者提供に関する同意（該当する場合）

- [ ] **安全管理措置**
  - [ ] 組織的安全管理措置（責任者の明確化）
  - [ ] 人的安全管理措置（職員教育）
  - [ ] 物理的安全管理措置（サーバー室施錠等）
  - [ ] 技術的安全管理措置（アクセス制御、暗号化）

### 8.2 障害福祉サービス関連法令

- [ ] **記録保存義務**
  - [ ] 出席記録の5年間保存体制
  - [ ] 日報の5年間保存体制
  - [ ] バックアップによる長期保存確認

- [ ] **情報開示対応**
  - [ ] 利用者本人への情報開示手順
  - [ ] 行政監査への対応手順

### 8.3 その他法令

- [ ] **電子帳簿保存法**（該当する場合）
  - [ ] 電子データの真実性確保（タイムスタンプ等）
  - [ ] 検索要件の充足

- [ ] **著作権・ライセンス**
  - [ ] 使用ライブラリのライセンス確認
  - [ ] オープンソースライセンス遵守

---

## 9. 性能・負荷対策

### 9.1 性能目標

- [ ] **レスポンスタイム目標**
  - [ ] ページ読み込み: 3秒以内
  - [ ] 個人ダッシュボードAPI: 2.5秒以内
  - [ ] 出席管理画面: 3秒以内

- [ ] **負荷試験**
  - [ ] 同時アクセス数50人でのテスト
  - [ ] ピーク時（朝の出勤打刻時）のテスト
  - [ ] 負荷試験ツール実行（Apache JMeter等）

### 9.2 最適化実施確認

- [ ] **アプリケーション最適化**
  - [ ] N+1クエリ問題解消確認
  - [ ] キャッシュ戦略実装確認（祝日、設定値等）
  - [ ] 画像最適化（圧縮、WebP形式等）

- [ ] **サーバー最適化**
  - [ ] OPcache有効化・設定
  - [ ] Nginx Gzip圧縮有効化
  - [ ] 静的ファイルのブラウザキャッシュ設定

### 9.3 スケーリング計画

- [ ] **垂直スケーリング（スケールアップ）**
  - [ ] CPU・メモリ増設計画
  - [ ] ディスク増設計画

- [ ] **水平スケーリング（スケールアウト）**
  - [ ] ロードバランサー導入計画（利用者増加時）
  - [ ] データベースレプリケーション計画

---

## 10. ユーザー対応準備

### 10.1 導入トレーニング

- [ ] **職員向けトレーニング**
  - [ ] システム操作研修の実施
  - [ ] マニュアル配布
  - [ ] Q&Aセッションの実施

- [ ] **利用者向けトレーニング**
  - [ ] ログイン方法の説明
  - [ ] 日報入力方法の説明
  - [ ] デモ環境での練習機会提供

### 10.2 サポート体制

- [ ] **問い合わせ窓口**
  - [ ] ヘルプデスクメールアドレス設定
  - [ ] または、電話サポート窓口設置
  - [ ] 対応時間の明示（平日9-17時等）

- [ ] **トラブルシューティング**
  - [ ] よくある問い合わせのFAQ作成
  - [ ] トラブル発生時の一次対応フロー

### 10.3 移行作業

- [ ] **既存データ移行**（該当する場合）
  - [ ] Excel/紙データのデジタル化
  - [ ] データインポートスクリプト作成
  - [ ] 移行データの妥当性確認

- [ ] **並行稼働期間**
  - [ ] 旧システムとの並行稼働期間設定（1-2週間推奨）
  - [ ] データ整合性確認
  - [ ] 問題発生時のロールバック計画

### 10.4 リリース計画

- [ ] **リリース日程**
  - [ ] リリース日の決定（月初・月末は避ける）
  - [ ] リリース時間の決定（業務時間外推奨）
  - [ ] リリース前の最終確認リスト

- [ ] **周知活動**
  - [ ] 職員への事前通知（1週間前）
  - [ ] 利用者への案内（掲示、配布物）
  - [ ] リリース当日の立ち会いサポート

---

## 11. リリース直前チェック

### 11.1 セキュリティ最終確認

- [ ] `.env` ファイル内容の最終確認
- [ ] `APP_DEBUG=false` 確認
- [ ] テストアカウントの完全削除確認
- [ ] データベースパスワードの強度確認
- [ ] SSL証明書の有効期限確認（3ヶ月以上）

### 11.2 機能最終確認

- [ ] 全主要機能の動作確認（本番環境）
- [ ] 2FA メール送信確認
- [ ] CSV出力確認
- [ ] エラーページ表示確認（404, 500, 403）

### 11.3 バックアップ最終確認

- [ ] バックアップスクリプトの動作確認
- [ ] バックアップからのリストア成功確認
- [ ] リモートストレージへのアップロード確認

### 11.4 監視最終確認

- [ ] 監視アラート受信テスト
- [ ] ログ出力確認
- [ ] ディスク容量確認

---

## 12. リリース後の対応

### 12.1 リリース当日

- [ ] **リリース作業**
  - [ ] リリース作業の実施
  - [ ] 動作確認（全機能）
  - [ ] 職員への周知

- [ ] **監視強化**
  - [ ] エラーログの常時監視
  - [ ] アクセス状況の監視
  - [ ] リソース使用率の監視

### 12.2 リリース後1週間

- [ ] **日次確認**
  - [ ] エラーログレビュー
  - [ ] ユーザーからの問い合わせ対応
  - [ ] パフォーマンス確認

- [ ] **改善活動**
  - [ ] ユーザーフィードバック収集
  - [ ] 軽微な改善実施

### 12.3 リリース後1ヶ月

- [ ] **総合レビュー**
  - [ ] システム稼働状況レビュー
  - [ ] ユーザー満足度調査
  - [ ] パフォーマンスレビュー
  - [ ] セキュリティ監査

- [ ] **改善計画**
  - [ ] 改善項目のリストアップ
  - [ ] 優先順位付け
  - [ ] 実装計画策定

---

## 13. 継続的改善

### 13.1 定期メンテナンス

- [ ] **月次メンテナンス**
  - [ ] セキュリティアップデート
  - [ ] パフォーマンスチューニング
  - [ ] ログファイルの整理

- [ ] **四半期メンテナンス**
  - [ ] Laravel バージョンアップ検討
  - [ ] データベース最適化（OPTIMIZE TABLE）
  - [ ] ディスク容量計画の見直し

- [ ] **年次メンテナンス**
  - [ ] セキュリティ監査の実施
  - [ ] DR訓練の実施
  - [ ] インフラ構成の見直し

### 13.2 機能追加計画

- [ ] ユーザー要望の収集・分析
- [ ] 新機能の優先順位付け
- [ ] 開発ロードマップの策定

---

## 付録A: 推奨構成・コスト

### 小規模事業所（利用者20名以下）

**推奨構成**: VPS（ConoHa 4GB）
**初期費用**: 約10万円（構築作業）
**月額費用**: 約3,000円（VPS + バックアップ）

### 中規模事業所（利用者50名以下）

**推奨構成**: VPS（8GB RAM） + 外部バックアップ
**初期費用**: 約15万円
**月額費用**: 約8,000円

### 大規模事業所（利用者100名以上）

**推奨構成**: AWS ECS + RDS（Multi-AZ）
**初期費用**: 約20万円
**月額費用**: 約10-15万円

---

## 付録B: 緊急連絡先テンプレート

```
【AYUMIシステム 緊急連絡先】

■システム管理者
氏名:
電話:
メール:

■運用担当者
氏名:
電話:
メール:

■インフラベンダー
会社名:
サポート窓口:
契約番号:

■緊急時対応フロー
1. システム管理者へ連絡
2. 30分以内に対応開始
3. 1時間以内に一次報告
4. 必要に応じてベンダーエスカレーション
```

---

## 付録C: 参考資料

- [Laravel公式デプロイガイド](https://laravel.com/docs/deployment)
- [個人情報保護委員会 ガイドライン](https://www.ppc.go.jp/)
- [Let's Encrypt](https://letsencrypt.org/)
- [OWASP Top 10](https://owasp.org/www-project-top-ten/)

---

**このチェックリストの使い方**:
1. 各項目を順番に確認
2. 完了した項目にチェック ✅
3. 全項目完了後、リリース判定会議を実施
4. リリース承認後、本番リリース実施

**最終更新日**: 2025年11月4日
